# Extraction Engine

The extraction engine runs config-driven pipelines over transcript JSON to produce structured features. It powers both the agent scorecard extraction and parts of the VOC pipeline.

## Core components

- `PipelineBase`: shared pipeline interface (`src/novus_calls/core/pipelines/base.py`).
- `ExtractionPipeline`: async pipeline runner (`src/novus_calls/core/extraction/pipeline.py`).
- `ExtractionPipelineStepConfig`: step model with routing and LLM settings (`src/novus_calls/core/extraction/models.py`).
- `ExtensionFactory`: dynamic extension loader (`src/novus_calls/core/extensions/factory.py`).

## How it works

1. Load a `PipelineConfig` from YAML or JSON.
2. Resolve each step to a concrete extension class.
3. Run the initial step, then enqueue next steps based on output or metadata.
4. Use a semaphore to limit concurrent LLM calls when `max_concurrent` is set.

## Step routing

`next_steps` supports conditional branching based on:

- LLM answers (`if_llm_answer`).
- Metadata (`if_metadata`).

This allows dynamic flows like running follow-up questions only when the model answers "yes" or when metadata indicates a certain call type.

## Configuration inputs

The extraction flow is controlled by:

- `extraction_pipeline.yaml` (steps and routing).
- `pipeline.json` (expanded step-by-step definition generated by `novus build`).
- Prompt templates and function schema files.

For deeper configuration details, see `configuration/extraction-pipeline.md`.

## Related docs

- `modules/extraction-extensions.md`
- `tutorials/build-pipeline.md`
